{
  "file": "lib/update-watchman-config.js",
  "content": "<pre class=\"language-javascript line-numbers\"><code class=\"language-javascript}\"><span aria-hidden=\"true\" role=\"presentation\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> dummyPublicPath <span class=\"token operator\">=</span> <span class=\"token string\">'tests/dummy/public'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> outputJson<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">/**\n * Adds a new filepath to a ember addon projects .watchmanconfig file to\n * prevent live reload from going into an infinite loop when docs are built\n * into an addon's dummy/public folder.\n * @class updateWatchmanConfig\n * @constructor\n * @param {Object} watchmanConfig The .watchmanconfig file object\n * @param {String} watchmanConfigFilepath The filepath for a .watchmanconfig file\n * @return {undefined}\n */</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token function\">updateWatchmanConfig</span><span class=\"token punctuation\">(</span>\n  watchmanConfig<span class=\"token punctuation\">,</span>\n  watchmanConfigFilepath\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  watchmanConfigFilepath <span class=\"token operator\">=</span> watchmanConfigFilepath <span class=\"token operator\">||</span> <span class=\"token string\">'.watchmanconfig'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\" spellcheck=\"true\">// Add the dummy app public path to the ignore_dirs property in the config</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>watchmanConfig<span class=\"token punctuation\">.</span>ignore_dirs <span class=\"token operator\">&amp;&amp;</span>\n      watchmanConfig<span class=\"token punctuation\">.</span>ignore_dirs<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>dummyPublicPath<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    watchmanConfig<span class=\"token punctuation\">.</span>ignore_dirs<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>dummyPublicPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\" spellcheck=\"true\">// Save the updated config</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    outputJson <span class=\"token operator\">=</span> JSON<span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>watchmanConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>watchmanConfigFilepath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> outputJson<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> encoding<span class=\"token punctuation\">:</span> <span class=\"token string\">'utf8'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Failed to write file: .watchmanconfig'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>"
}